<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Property Portfolio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb;
        }
        [contenteditable]:focus {
            outline: 2px solid #3b82f6;
            background-color: #eff6ff;
            border-radius: 4px;
        }
        [contenteditable]:hover {
            background-color: #f3f4f6;
            cursor: text;
        }
        .property-card-overlay {
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .group:hover .property-card-overlay {
            opacity: 1;
        }
        .hero-bg {
            background-image: url('https://images.unsplash.com/photo-1568605114967-8130f3a36994?q=80&w=2070&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
        }
        /* Custom styles for the filter dropdowns */
        .custom-select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1em;
            padding-right: 2.5rem;
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Header Navigation -->
    <header class="bg-white/80 backdrop-blur-md sticky top-0 z-50 border-b">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" class="text-2xl font-bold text-gray-900">Bli Made<span class="text-blue-600">.</span></a>
            <div class="hidden md:flex items-center space-x-8">
                <a href="#" class="text-gray-600 hover:text-blue-600 font-medium transition duration-300">Home</a>
                <a href="#properties" class="text-gray-600 hover:text-blue-600 font-medium transition duration-300">Properties</a>
                <a href="#about" class="text-gray-600 hover:text-blue-600 font-medium transition duration-300">About</a>
            </div>
            <button class="md:hidden focus:outline-none" id="mobile-menu-button">
                 <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>
        </nav>
        <div class="hidden md:hidden" id="mobile-menu">
            <a href="#" class="block py-2 px-6 text-sm hover:bg-gray-100">Home</a>
            <a href="#properties" class="block py-2 px-6 text-sm hover:bg-gray-100">Properties</a>
            <a href="#about" class="block py-2 px-6 text-sm hover:bg-gray-100">About</a>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero-bg text-white w-full">
        <div class="bg-black/50 min-h-[50vh] flex items-center justify-center">
            <div class="text-center px-6">
                <h1 id="hero-title" contenteditable="true" onblur="saveText('hero-title')" class="text-4xl md:text-6xl font-bold leading-tight mb-4 p-2 rounded">Find Your Next Chapter</h1>
                <p id="hero-subtitle" contenteditable="true" onblur="saveText('hero-subtitle')" class="text-lg md:text-xl text-gray-200 max-w-3xl mx-auto p-2 rounded">We specialize in connecting discerning buyers with exceptional properties. Your dream home is waiting.</p>
            </div>
        </div>
    </section>

    <!-- Main Content Area -->
    <main class="container mx-auto px-6 py-12 md:py-20">
        <!-- Properties Section -->
        <section id="properties">
            <h2 class="text-3xl font-bold mb-4 text-center">Properties</h2>
            
            <!-- Filter Controls -->
            <div class="flex flex-col sm:flex-row gap-4 justify-center mb-8">
                <div class="relative">
                    <select id="location-filter" class="custom-select w-full sm:w-48 border border-gray-300 rounded-lg p-2 bg-white shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="all">All Locations</option>
                    </select>
                </div>
                <div class="relative">
                    <select id="type-filter" class="custom-select w-full sm:w-48 border border-gray-300 rounded-lg p-2 bg-white shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="all">All Types</option>
                    </select>
                </div>
            </div>

            <!-- Property Grid -->
            <div id="property-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
                <!-- Property cards will be dynamically inserted here -->
            </div>
            <div class="text-center mt-8">
                 <button id="add-property-btn" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition duration-300 font-semibold">Add New Property</button>
            </div>
        </section>
        

        <!-- Profile Section -->
        <section id="about" class="flex flex-col md:flex-row items-center gap-8 md:gap-12 mt-20 bg-white p-10 rounded-lg shadow-sm">
            <div class="relative group">
                <img id="profile-picture" src="https://images.unsplash.com/photo-1560250097-0b93528c311a?q=80&w=1887&auto=format&fit=crop" alt="Profile Picture" class="w-40 h-40 md:w-48 md:h-48 rounded-full object-cover border-4 border-white shadow-md">
                <div class="absolute inset-0 rounded-full bg-black bg-opacity-50 flex items-center justify-center property-card-overlay">
                    <button onclick="openImageModal(null, 'profile-picture')" class="text-white bg-blue-600 px-4 py-2 rounded-lg text-sm font-semibold">Change</button>
                </div>
            </div>
            <div class="text-center md:text-left flex-1">
                <h1 id="profile-title" contenteditable="true" onblur="saveText('profile-title')" class="text-3xl md:text-4xl font-bold mb-2 p-2 rounded">About Bli Made</h1>
                <p id="profile-description" contenteditable="true" onblur="saveText('profile-description')" class="text-gray-600 p-2 rounded">This is a description about the person or the agency. You can click here to edit this text.</p>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer id="contact" class="bg-gray-800 text-gray-300 w-full mt-20">
        <div class="container mx-auto px-6 py-12">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center md:text-left">
                <div>
                    <h3 class="text-xl font-bold mb-4 text-white">Bli Made<span class="text-blue-500">.</span></h3>
                    <p class="text-gray-400">Your key to exceptional living.</p>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4 text-white">Contact Us</h3>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="mailto:aryagnwn@gmail.com" class="hover:text-white transition">aryagnwn@gmail.com</a></li>
                        <li><a href="tel:+6285737222705" class="hover:text-white transition">+62 857-3722-2705</a></li>
                        <li>Br. Pejeng aji, Tegallalang, Gianyar, Bali 80561</li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4 text-white">Follow Us</h3>
                    <div class="flex justify-center md:justify-start space-x-4">
                       <a href="#" class="text-gray-400 hover:text-white transition"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z" clip-rule="evenodd" /></svg></a>
                       <a href="#" class="text-gray-400 hover:text-white transition"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.71v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84" /></svg></a>
                       <a href="#" class="text-gray-400 hover:text-white transition"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M12.315 2c2.43 0 2.784.013 3.808.06 1.064.049 1.791.218 2.427.465a4.902 4.902 0 012.792 2.792c.247.636.416 1.363.465 2.427.048 1.024.06 1.378.06 3.808s-.012 2.784-.06 3.808c-.049 1.064-.218 1.791-.465 2.427a4.902 4.902 0 01-2.792 2.792c-.636.247-1.363.416-2.427.465-1.024.048-1.378.06-3.808.06s-2.784-.013-3.808-.06c-1.064-.049-1.791-.218-2.427-.465a4.902 4.902 0 01-2.792-2.792c-.247-.636-.416-1.363-.465-2.427-.048-1.024-.06-1.378-.06-3.808s.012-2.784.06-3.808c.049-1.064.218-1.791.465-2.427a4.902 4.902 0 012.792-2.792c.636-.247 1.363.416 2.427.465C9.53 2.013 9.884 2 12.315 2zM12 8.118c-2.146 0-3.882 1.736-3.882 3.882s1.736 3.882 3.882 3.882 3.882-1.736 3.882-3.882-1.736-3.882-3.882-3.882zM12 14.25a2.25 2.25 0 110-4.5 2.25 2.25 0 010 4.5zM16.882 8.292a1.156 1.156 0 100-2.312 1.156 1.156 0 000 2.312z" clip-rule="evenodd" /></svg></a>
                    </div>
                </div>
            </div>
            <div class="mt-8 border-t border-gray-700 pt-6 text-center text-gray-500 text-sm">
                <p>&copy; 2025 Bli Made. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Modals -->
    <div id="image-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white p-8 rounded-lg shadow-xl w-11/12 max-w-md">
            <h3 class="text-xl font-bold mb-4">Change Image</h3>
            <p class="text-sm text-gray-600 mb-4">Paste the new image URL below:</p>
            <input type="text" id="image-url-input" class="w-full border p-2 rounded mb-4" placeholder="https://example.com/image.jpg">
            <div class="flex justify-end space-x-4">
                <button onclick="closeModal('image-modal')" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">Cancel</button>
                <button onclick="saveImage()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Save</button>
            </div>
        </div>
    </div>
    
    <div id="property-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white p-8 rounded-lg shadow-xl w-11/12 max-w-md">
            <h3 class="text-xl font-bold mb-4">Add New Property</h3>
            <div class="space-y-4">
                <input type="text" id="new-property-title" placeholder="Property Title" class="w-full border p-2 rounded">
                <input type="text" id="new-property-location" placeholder="Location (e.g., Denpasar)" class="w-full border p-2 rounded">
                <input type="text" id="new-property-type" placeholder="Type (e.g., Villa)" class="w-full border p-2 rounded">
                <input type="text" id="new-property-image" placeholder="Image URL" class="w-full border p-2 rounded">
            </div>
            <div class="flex justify-end space-x-4 mt-6">
                <button onclick="closeModal('property-modal')" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">Cancel</button>
                <button onclick="addProperty()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Add Property</button>
            </div>
        </div>
    </div>


    <!-- Firebase and App Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-editable-website';

        let auth, db, userId;
        let currentImageElementId = null;
        let currentPropertyId = null; 
        let localProperties = [];

        const FOLDER_NAME = 'pageContent';
        const DOC_NAME = 'main';

        async function initializeFirebase() {
            const app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            onAuthStateChanged(auth, async user => {
                if (user) {
                    userId = user.uid;
                    listenForContentChanges();
                } else {
                    const token = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
                    if (token) await signInWithCustomToken(auth, token);
                    else await signInAnonymously(auth);
                }
            });
        }
        
        function getDocRef() {
            return doc(db, "artifacts", appId, "users", userId, FOLDER_NAME, DOC_NAME);
        }

        function listenForContentChanges() {
            if (!userId) return;
            onSnapshot(getDocRef(), (docSnap) => {
                if (docSnap.exists()) {
                    updatePageContent(docSnap.data());
                } else {
                    createInitialDocument();
                }
            }, console.error);
        }
        
        function populateFilters() {
            const locationFilter = document.getElementById('location-filter');
            const typeFilter = document.getElementById('type-filter');
            
            const locations = [...new Set(localProperties.map(p => p.location))];
            const types = [...new Set(localProperties.map(p => p.type))];

            locationFilter.innerHTML = '<option value="all">All Locations</option>';
            typeFilter.innerHTML = '<option value="all">All Types</option>';

            locations.forEach(location => {
                const option = document.createElement('option');
                option.value = location;
                option.textContent = location.charAt(0).toUpperCase() + location.slice(1);
                locationFilter.appendChild(option);
            });
            
            types.forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = type.charAt(0).toUpperCase() + type.slice(1);
                typeFilter.appendChild(option);
            });
        }

        function renderProperties() {
            const grid = document.getElementById('property-grid');
            grid.innerHTML = '';
            
            const locationFilter = document.getElementById('location-filter').value;
            const typeFilter = document.getElementById('type-filter').value;

            const filteredProperties = localProperties.filter(p => 
                (locationFilter === 'all' || p.location === locationFilter) &&
                (typeFilter === 'all' || p.type === typeFilter)
            );

            filteredProperties.forEach(prop => {
                const card = document.createElement('div');
                card.className = 'bg-white rounded-lg shadow-md overflow-hidden group';
                card.innerHTML = `
                    <div class="relative">
                        <img id="img-${prop.id}" src="${prop.imageUrl}" alt="${prop.title}" class="w-full h-48 object-cover">
                        <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center property-card-overlay">
                            <button onclick="window.openImageModal('${prop.id}')" class="text-white bg-blue-600 px-4 py-2 rounded-lg text-sm font-semibold">Change Image</button>
                        </div>
                    </div>
                    <div class="p-4">
                        <h3 id="title-${prop.id}" contenteditable="true" onblur="window.savePropertyText('${prop.id}', this.textContent)" class="text-xl font-semibold p-1 rounded">${prop.title}</h3>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function updatePageContent(data) {
            document.getElementById('hero-title').textContent = data.heroTitle || 'Find Your Next Chapter';
            document.getElementById('hero-subtitle').textContent = data.heroSubtitle || 'Your dream home is waiting.';
            document.getElementById('profile-title').textContent = data.profileTitle || 'About Bli Made';
            document.getElementById('profile-description').textContent = data.profileDescription || 'Edit this description.';
            document.getElementById('profile-picture').src = data.profilePictureUrl || 'https://images.unsplash.com/photo-1560250097-0b93528c311a?q=80&w=1887&auto=format&fit=crop';
        
            localProperties = data.properties || [];
            populateFilters();
            renderProperties();
        }

        async function createInitialDocument() {
            if (!userId) return;
            const initialData = {
                heroTitle: 'Find Your Next Chapter',
                heroSubtitle: 'Your dream home is waiting.',
                profileTitle: 'About Bli Made',
                profileDescription: 'This is a description about the person or the agency.',
                profilePictureUrl: 'https://images.unsplash.com/photo-1560250097-0b93528c311a?q=80&w=1887&auto=format&fit=crop',
                properties: [
                    { id: 'villa1', title: 'Modern Villa', location: 'denpasar', type: 'villa', imageUrl: 'https://images.unsplash.com/photo-1613490493576-7fde63acd811?q=80&w=2071&auto=format&fit=crop' },
                    { id: 'ruko1', title: 'Family Home', location: 'gianyar', type: 'ruko', imageUrl: 'https://images.unsplash.com/photo-1570129477492-45c003edd2be?q=80&w=2070&auto=format&fit=crop' },
                    { id: 'freehold1', title: 'Poolside Paradise', location: 'denpasar', type: 'freehold', imageUrl: 'https://images.unsplash.com/photo-1564013799919-ab600027ffc6?q=80&w=2070&auto=format&fit=crop' },
                    { id: 'leasehold1', title: 'Suburban Dream', location: 'tegallalang', type: 'leasehold', imageUrl: 'https://images.unsplash.com/photo-1580587771525-78b9dba3b914?q=80&w=1974&auto=format&fit=crop' },
                ]
            };
            await setDoc(getDocRef(), initialData);
        }

        window.saveText = async (elementId) => {
            const key = elementId.replace(/-(\w)/g, (_, c) => c.toUpperCase());
            const content = document.getElementById(elementId).textContent;
            await updateDoc(getDocRef(), { [key]: content });
        };

        window.savePropertyText = async (propId, text) => {
            const properties = localProperties.map(p => p.id === propId ? { ...p, title: text } : p);
            await updateDoc(getDocRef(), { properties });
        }

        window.saveImage = async () => {
            const newUrl = document.getElementById('image-url-input').value;
            if (!newUrl.startsWith('http')) return;
            
            if (currentPropertyId) {
                const properties = localProperties.map(p => p.id === currentPropertyId ? { ...p, imageUrl: newUrl } : p);
                await updateDoc(getDocRef(), { properties });
            } else if(currentImageElementId === 'profile-picture') {
                await updateDoc(getDocRef(), { profilePictureUrl: newUrl });
            }
            closeModal('image-modal');
        };

        window.addProperty = async () => {
            const newProp = {
                id: 'prop' + Date.now(),
                title: document.getElementById('new-property-title').value,
                location: document.getElementById('new-property-location').value.toLowerCase(),
                type: document.getElementById('new-property-type').value.toLowerCase(),
                imageUrl: document.getElementById('new-property-image').value,
            };
            if (!newProp.title || !newProp.location || !newProp.type || !newProp.imageUrl) {
                alert("Please fill all fields.");
                return;
            }
            await updateDoc(getDocRef(), { properties: arrayUnion(newProp) });
            closeModal('property-modal');
        }

        window.openImageModal = (propId, elementId) => {
            currentPropertyId = propId;
            currentImageElementId = elementId;
            document.getElementById('image-modal').classList.remove('hidden');
            document.getElementById('image-modal').classList.add('flex');
        };
        
        window.closeModal = (modalId) => {
            document.getElementById(modalId).classList.add('hidden');
            document.getElementById(modalId).classList.remove('flex');
        };

        document.getElementById('location-filter').addEventListener('change', renderProperties);
        document.getElementById('type-filter').addEventListener('change', renderProperties);
        document.getElementById('add-property-btn').addEventListener('click', () => {
             document.getElementById('property-modal').classList.remove('hidden');
             document.getElementById('property-modal').classList.add('flex');
        });
        document.getElementById('mobile-menu-button').addEventListener('click', () => {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        });

        initializeFirebase();
    </script>
</body>
</html>
